<%- include('./partials/header') %>

<!-- SUCCESS MESSAGE -->
<% if (success && success.length > 0) { %>
  <div class="fixed top-5 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-md bg-green-600 shadow-lg">
    <span class="text-white font-semibold"><%= success %></span>
  </div>
<% } %>

<div class="w-full min-h-screen px-20 py-20 flex gap-10 bg-gray-50">

  <!-- LEFT: CART ITEMS -->
  <div class="w-[65%] space-y-6">

    <h2 class="text-2xl font-semibold mb-6">ðŸ›’ My Cart</h2>

    <% if (cartProducts.length === 0) { %>
      <div class="p-10 bg-white rounded-md shadow">
        <h3 class="text-xl text-gray-600">Your cart is empty</h3>
        <a href="/shop" class="inline-block mt-4 px-5 py-2 bg-black text-white rounded-md">
          Continue Shopping
        </a>
      </div>
    <% } %>

    <% cartProducts.forEach(function(product){ %>
      <div class="w-full bg-white rounded-md shadow flex overflow-hidden">

        <!-- IMAGE -->
        <div class="w-[30%] h-48 flex items-center justify-center bg-[<%= product.bgcolor %>]">
          <img
            class="h-[10rem]"
            src="data:image/jpeg;base64,<%= product.image.toString('base64') %>"
            alt="<%= product.name %>"
          />
        </div>

        <!-- DETAILS -->
        <div class="w-[70%] px-6 py-5 flex flex-col justify-between">

          <div>
            <h3 class="text-xl font-semibold">
              <%= product.brand %> <%= product.name %>
            </h3>
            <p class="text-gray-500 mt-1">Premium Quality Product</p>
          </div>

          <div class="flex items-center justify-between mt-4">

            <!-- QUANTITY (STATIC FOR NOW) -->
            <div class="flex items-center gap-3">
              <a 
  href="/product/removefromcart/<%= product._id %>"
  class="w-8 h-8 flex items-center justify-center bg-gray-200 rounded-full hover:bg-red-200 transition">
  -
</a>

              <span class="px-3 py-1 border rounded-md">1</span>
              <span class="w-8 h-8 flex items-center justify-center bg-gray-200 rounded-full cursor-pointer">
                +
              </span>
            </div>

            <!-- PRICE -->
            <h4 class="text-lg font-semibold">
              â‚¹ <%= product.price %>
            </h4>
          </div>

        </div>
      </div>
    <% }) %>

  </div>

  <!-- RIGHT: PRICE SUMMARY -->
  <div class="w-[35%] h-fit bg-white rounded-md shadow p-8 sticky top-20">

    <h3 class="text-xl font-semibold mb-6">Price Details</h3>

    <%
  let totalMRP = 0;
  let totalDiscountAmount = 0;

  cartProducts.forEach(p => {
    totalMRP += p.price;

    if (p.discount && p.discount > 0) {
      totalDiscountAmount += (p.price * p.discount) / 100;
    }
  });

  const platformFee = 20;
  const finalAmount = totalMRP - totalDiscountAmount + platformFee;
%>


    <div class="space-y-4 text-gray-700">
      <div class="flex justify-between">
        <span>Total MRP</span>
        <span>â‚¹ <%= totalMRP %></span>
      </div>

      <div class="flex justify-between">
        <span>Discount</span>
        <span class="text-green-600"><%= totalDiscountAmount %></span>
      </div>

      <div class="flex justify-between">
        <span>Platform Fee</span>
        <span>â‚¹ 20</span>
      </div>

      <div class="flex justify-between">
        <span>Shipping</span>
        <span class="text-green-600">FREE</span>
      </div>
    </div>

    <div class="w-full h-[1px] bg-gray-300 my-6"></div>

    <div class="flex justify-between text-xl font-semibold">
      <span>Total Amount</span>
      <span class="text-green-600">â‚¹ <%= finalAmount %></span>
    </div>

    <button class="w-full mt-6 py-3 bg-black text-white rounded-md hover:bg-gray-800 transition">
      Place Order
    </button>

  </div>

</div>

<%- include('./partials/footer') %>
